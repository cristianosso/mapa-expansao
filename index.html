<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Expansão - Análise de Concorrência</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 360px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow-y: auto; padding: 20px; }
        .map { flex: 1; }
        h1 { font-size: 22px; margin-bottom: 5px; color: #333; }
        .subtitle { font-size: 12px; color: #999; margin-bottom: 15px; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: #f5f5f5; padding: 12px; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 11px; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 26px; font-weight: bold; }
        .blue { color: #3B82F6; }
        .red { color: #EF4444; }
        .green { color: #10B981; }
        .controls { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-size: 12px; font-weight: 500; }
        input[type="checkbox"] { width: auto; }
        select { width: 100%; padding: 7px; border: 1px solid #ddd; border-radius: 4px; font-size: 11px; margin-bottom: 5px; }
        .legend { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-top: 15px; }
        .legend-title { font-size: 11px; font-weight: 600; margin-bottom: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 11px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
        .info-box { background: #fffbeb; border-left: 4px solid #fbbf24; padding: 10px; border-radius: 4px; margin-top: 12px; font-size: 11px; }
        .info-title { font-weight: 600; color: #92400e; margin-bottom: 4px; }
        .info-text { color: #b45309; line-height: 1.4; }
        .info-box.updated { background: #ecfdf5; border-left-color: #10B981; }
        .info-box.updated .info-title { color: #065f46; }
        .info-box.updated .info-text { color: #047857; }
        .info-box.blue-box { background: #eff6ff; border-left-color: #3B82F6; }
        .info-box.blue-box .info-title { color: #1e40af; }
        .info-box.blue-box .info-text { color: #1d4ed8; }
        .region-filter { margin-top: 5px; }
        .region-stats { margin-top: 12px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .region-stats-title { font-size: 11px; font-weight: 600; margin-bottom: 6px; }
        .region-stat-row { display: flex; justify-content: space-between; font-size: 11px; padding: 3px 0; border-bottom: 1px solid #eee; }
        .region-stat-row:last-child { border-bottom: none; }
        .region-stat-count { font-weight: bold; }
        .search-box { margin-bottom: 10px; }
        .search-box input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Mapa de Expansão</h1>
            <p class="subtitle">Análise de Concorrência - Medicina do Trabalho - Grande SP</p>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Suas Unidades</div>
                    <div class="stat-value blue">19</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Concorrentes</div>
                    <div class="stat-value red" id="compCount">127</div>
                </div>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar clínica por nome..." oninput="updateMarkers()">
            </div>

            <div class="controls">
                <label>
                    <input type="checkbox" id="showCompetitors" checked> Mostrar Concorrentes
                </label>
                
                <label>Filtrar Fase (Suas Unidades)</label>
                <select id="phaseFilter">
                    <option value="">Todas as Fases</option>
                    <option value="F1">F1 - Âncora</option>
                    <option value="F2">F2 - Expansão</option>
                    <option value="F3">F3 - Dominação</option>
                    <option value="F4">F4 - Metropolitana</option>
                </select>

                <div class="region-filter">
                    <label>Filtrar Região Concorrentes</label>
                    <select id="regionFilter">
                        <option value="">Todas as Regiões</option>
                        <option value="centro">SP - Centro</option>
                        <option value="norte">SP - Zona Norte</option>
                        <option value="sul">SP - Zona Sul</option>
                        <option value="oeste">SP - Zona Oeste</option>
                        <option value="leste">SP - Zona Leste</option>
                        <option value="grande_sp">Grande SP (ABC, Guarulhos, Osasco...)</option>
                    </select>
                </div>
            </div>

            <div class="region-stats" id="regionStats">
                <div class="region-stats-title">CONCORRENTES POR REGIÃO</div>
                <div id="regionStatsContent"></div>
            </div>

            <div class="legend">
                <div class="legend-title">LEGENDA</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #3B82F6; border: 2px solid #1E40AF;"></div>
                    <span>Suas Unidades (Azul)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #EF4444; border: 2px solid #991B1B;"></div>
                    <span>SP - Centro (Vermelho)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #F97316; border: 2px solid #C2410C;"></div>
                    <span>SP - Zona Leste (Laranja)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #8B5CF6; border: 2px solid #6D28D9;"></div>
                    <span>SP - Zona Norte (Roxo)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #EC4899; border: 2px solid #BE185D;"></div>
                    <span>SP - Zona Sul (Rosa)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #14B8A6; border: 2px solid #0D9488;"></div>
                    <span>SP - Zona Oeste (Teal)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #F59E0B; border: 2px solid #D97706;"></div>
                    <span>Grande SP (Amarelo)</span>
                </div>
            </div>

            <div class="info-box updated">
                <div class="info-title">REVISÃO COMPLETA - Fev/2026</div>
                <div class="info-text">Mapa revisado com 127 clínicas de medicina do trabalho verificadas no Google Maps. Cobertura: SP Capital (Centro, Zona Norte, Sul, Leste, Oeste) + Grande SP (Guarulhos, ABC, Osasco, Barueri, Taboão, Embu, Cotia, Diadema e mais).</div>
            </div>

            <div class="info-box blue-box" style="margin-top: 8px;">
                <div class="info-title">DADOS VERIFICADOS</div>
                <div class="info-text">Apenas clínicas especializadas em medicina do trabalho / medicina ocupacional. Hospitais, laboratórios gerais e clínicas de outras especialidades foram removidos.</div>
            </div>
        </div>

        <div class="map" id="map"></div>
    </div>

    <script>
        const suas_unidades = [
            { fase: "F1", nome: "Paulista", lat: -23.5505, lng: -46.6561, custo: "R$ 80.5K", faturamento: "R$ 160K" },
            { fase: "F1", nome: "Santo Amaro", lat: -23.6245, lng: -46.6561, custo: "R$ 71.5K", faturamento: "R$ 140K" },
            { fase: "F1", nome: "Tatuapé", lat: -23.5305, lng: -46.5561, custo: "R$ 69.7K", faturamento: "R$ 135K" },
            { fase: "F1", nome: "Lapa", lat: -23.5205, lng: -46.6861, custo: "R$ 64.7K", faturamento: "R$ 120K" },
            { fase: "F2", nome: "Itaim Bibi", lat: -23.5889, lng: -46.6799, custo: "R$ 87.2K", faturamento: "R$ 200K" },
            { fase: "F2", nome: "Mooca", lat: -23.5405, lng: -46.5561, custo: "R$ 64.8K", faturamento: "R$ 125K" },
            { fase: "F2", nome: "Santana", lat: -23.4905, lng: -46.6161, custo: "R$ 65.5K", faturamento: "R$ 120K" },
            { fase: "F2", nome: "Penha", lat: -23.5205, lng: -46.4861, custo: "R$ 57.8K", faturamento: "R$ 100K" },
            { fase: "F2", nome: "Jabaquara", lat: -23.6145, lng: -46.5561, custo: "R$ 58.2K", faturamento: "R$ 95K" },
            { fase: "F3", nome: "Berrini", lat: -23.5889, lng: -46.6799, custo: "R$ 80K", faturamento: "R$ 180K" },
            { fase: "F3", nome: "Itaquera", lat: -23.5005, lng: -46.4261, custo: "R$ 52.7K", faturamento: "R$ 85K" },
            { fase: "F3", nome: "Vila Maria", lat: -23.4705, lng: -46.5561, custo: "R$ 58.3K", faturamento: "R$ 110K" },
            { fase: "F3", nome: "Pinheiros", lat: -23.5589, lng: -46.6989, custo: "R$ 71.5K", faturamento: "R$ 140K" },
            { fase: "F3", nome: "Centro", lat: -23.5505, lng: -46.6361, custo: "R$ 58.2K", faturamento: "R$ 110K" },
            { fase: "F3", nome: "Campo Limpo", lat: -23.6545, lng: -46.7561, custo: "R$ 52K", faturamento: "R$ 80K" },
            { fase: "F4", nome: "Guarulhos", lat: -23.4605, lng: -46.4861, custo: "R$ 63.9K", faturamento: "R$ 130K" },
            { fase: "F4", nome: "Osasco", lat: -23.5305, lng: -46.7961, custo: "R$ 59.1K", faturamento: "R$ 110K" },
            { fase: "F4", nome: "São Bernardo", lat: -23.6945, lng: -46.5661, custo: "R$ 65.6K", faturamento: "R$ 140K" },
            { fase: "F4", nome: "Alphaville", lat: -23.5705, lng: -46.8561, custo: "R$ 69.9K", faturamento: "R$ 150K" },
        ];

        const concorrentes = [
            { nome: "Lili Medicina do Trabalho", bairro: "Sé", cidade: "São Paulo", lat: -23.5506507, lng: -46.6333824, regiao: "centro" },
            { nome: "BC Work Medicina Ocupacional", bairro: "184", cidade: "Centro", lat: -23.4691692, lng: -46.5277406, regiao: "centro" },
            { nome: "Iso - Saúde Ocupacional", bairro: "Centro", cidade: "São Paulo", lat: -23.5458336, lng: -46.6391632, regiao: "centro" },
            { nome: "SJR Brasil", bairro: "Bela Vista", cidade: "São Paulo", lat: -23.5643368, lng: -46.6528472, regiao: "centro" },
            { nome: "Master Gestão Em Saude Ocupacional", bairro: "38", cidade: "Centro", lat: -23.6863182, lng: -46.6274711, regiao: "grande_sp" },
            { nome: "Clinica Médica Aurea", bairro: "54", cidade: "Rudge Ramos", lat: -23.6682265, lng: -46.567228, regiao: "grande_sp" },
            { nome: "PCM Medicina Ocupacional e Segurança do Trabalho: Unidade São Bernardo do Campo", bairro: "278", cidade: "Jardim do Mar", lat: -23.6943111, lng: -46.5551306, regiao: "grande_sp" },
            { nome: "MedTrab Assunção - Clínica de Medicina e Segurança do Trabalho", bairro: "3758", cidade: "Assunção", lat: -23.7234086, lng: -46.5745753, regiao: "grande_sp" },
            { nome: "MEDNET São Bernardo do Campo/SP - Medicina e Segurança do Trabalho", bairro: "112", cidade: "Jardim do Mar", lat: -23.6943111, lng: -46.5551306, regiao: "grande_sp" },
            { nome: "Asonet Ocupacional - Unidade de Atendimento São Bernardo do Campo", bairro: "730", cidade: "Jardim do Mar", lat: -23.6929709, lng: -46.556066, regiao: "grande_sp" },
            { nome: "Objetiva Medicina e Segurança do Trabalho", bairro: "1499", cidade: "Centro", lat: -23.689368, lng: -46.616315, regiao: "grande_sp" },
            { nome: "GedalMed - Medicina Ocupacional", bairro: "3394", cidade: "Rudge Ramos", lat: -23.6655455, lng: -46.569043, regiao: "grande_sp" },
            { nome: "Amo Assessoria em Medicina Ocupacional", bairro: "26", cidade: "Jardim do Mar", lat: -23.6921366, lng: -46.5559862, regiao: "grande_sp" },
            { nome: "Altha Advice on Medical and Safety Ltd.", bairro: "207", cidade: "Centro", lat: -23.7047853, lng: -46.5588961, regiao: "grande_sp" },
            { nome: "MEDNET Diadema/SP - Medicina e Segurança do Trabalho", bairro: "401", cidade: "Centro", lat: -23.6841529, lng: -46.6066774, regiao: "grande_sp" },
            { nome: "Diamed Saúde Ocupacional", bairro: "15", cidade: "Centro", lat: -23.6869803, lng: -46.6219975, regiao: "grande_sp" },
            { nome: "Med Prev Assis Médica Asses em Medicina Trabalho", bairro: "15", cidade: "Centro", lat: -23.6869803, lng: -46.6219975, regiao: "grande_sp" },
            { nome: "MEDNET Osasco/SP - Medicina e Segurança do Trabalho", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "SEG Saúde Ocupacional", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Uni Segurança e Medicina do Trabalho", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "GMEDSE - Gestão em Medicina e Segurança do Trabalho", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Setrab Group - Unidade Osasco", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Clínica Dra. Dinorah", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Predict Medical Center and Diagnostic Ltda", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Goldmed Medicina e Segurança do Trabalho - Osasco", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Artrab Osasco", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "COMO medicina ocupacional", bairro: "Centro", cidade: "Osasco", lat: -23.4754256, lng: -46.7773735, regiao: "grande_sp" },
            { nome: "Camargo Dantas Medicina e Segurança do Trabalho", bairro: "Centro", cidade: "Carapicuíba", lat: -23.5234523, lng: -46.8348105, regiao: "grande_sp" },
            { nome: "Occupational Medicine Center and Safety", bairro: "Centro", cidade: "Carapicuíba", lat: -23.5264727, lng: -46.8356734, regiao: "grande_sp" },
            { nome: "Mevmed Gestão Ocupacional", bairro: "Centro", cidade: "Carapicuíba", lat: -23.5264727, lng: -46.8356734, regiao: "grande_sp" },
            { nome: "Meseg Seguranca do Trabalho", bairro: "Centro", cidade: "Carapicuíba", lat: -23.5264727, lng: -46.8356734, regiao: "grande_sp" },
            { nome: "Healthwork", bairro: "363 - Cj 67", cidade: "Centro", lat: -23.6140517, lng: -46.569091, regiao: "grande_sp" },
            { nome: "Grupo Mednet", bairro: "Nº 70", cidade: "SANTA PAULA", lat: -23.6163705, lng: -46.5679506, regiao: "grande_sp" },
            { nome: "Stilo Segurança e Medicina do Trabalho", bairro: "185", cidade: "Centro Alto", lat: -23.7136321, lng: -46.4183775, regiao: "grande_sp" },
            { nome: "Alamed", bairro: "117", cidade: "Centro", lat: -23.7170696, lng: -46.4104745, regiao: "grande_sp" },
            { nome: "Clínica Próspera | Medicina & Segurança do Trabalho I 01 Cotia", bairro: "Centro", cidade: "Cotia", lat: -23.60533, lng: -46.92011, regiao: "grande_sp" },
            { nome: "CMO - Centro de Medicina Ocupacional", bairro: "Parque Bahia", cidade: "Cotia", lat: -23.60533, lng: -46.92011, regiao: "grande_sp" },
            { nome: "BM Medicina do Trabalho Ltda", bairro: "105", cidade: "Centro", lat: -23.5999988, lng: -46.7635899, regiao: "grande_sp" },
            { nome: "Camargo Dantas Clínica de Saúde Ocupacional - Cotia", bairro: "833", cidade: "Vila Monte Serrat", lat: -23.608375, lng: -46.9211778, regiao: "grande_sp" },
            { nome: "SEGURAMED", bairro: "111", cidade: "Centro", lat: -23.670448, lng: -46.4708377, regiao: "grande_sp" },
            { nome: "My Doctor Medicina do Trabalho", bairro: "Penha", cidade: "São Paulo", lat: -23.523683, lng: -46.5437815, regiao: "leste" },
            { nome: "CEDUSP", bairro: "Tatuapé", cidade: "São Paulo", lat: -23.5402524, lng: -46.5766424, regiao: "leste" },
            { nome: "Next Ocupacional", bairro: "Mooca", cidade: "São Paulo", lat: -23.5606808, lng: -46.5971924, regiao: "leste" },
            { nome: "Ultramed", bairro: "Vila Prudente", cidade: "São Paulo", lat: -23.5868367, lng: -46.5846413, regiao: "leste" },
            { nome: "Geremed", bairro: "Vila Prudente", cidade: "São Paulo", lat: -23.5846609, lng: -46.5833457, regiao: "leste" },
            { nome: "Setrab - Unidade Vila Mariana", bairro: "Vila Mariana", cidade: "São Paulo", lat: -23.5897089, lng: -46.6345233, regiao: "sul" },
            { nome: "Central Med Saude", bairro: "Vila Mariana", cidade: "São Paulo", lat: -23.5791887, lng: -46.6399989, regiao: "sul" },
            { nome: "UMA - Medicina e segurança do Trabalho", bairro: "Vila Mariana", cidade: "São Paulo", lat: -23.591572, lng: -46.6321999, regiao: "sul" },
            { nome: "Asonet Ocupacional - Vila Mariana", bairro: "Vila Mariana", cidade: "São Paulo", lat: -23.5881941, lng: -46.6323349, regiao: "sul" },
            { nome: "Paromed – Medicina e Segurança do Trabalho", bairro: "Paraíso", cidade: "São Paulo", lat: -23.5766882, lng: -46.641446, regiao: "sul" },
            { nome: "Aclimed – Medicina do Trabalho", bairro: "Aclimação", cidade: "São Paulo", lat: -23.5760002, lng: -46.6262024, regiao: "sul" },
            { nome: "Moema Assessoria", bairro: "Moema", cidade: "São Paulo", lat: -23.597085, lng: -46.6628884, regiao: "sul" },
            { nome: "CMS Assessoria", bairro: "Moema", cidade: "São Paulo", lat: -23.597085, lng: -46.6628884, regiao: "sul" },
            { nome: "CLIMEC", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6562303, lng: -46.7191156, regiao: "sul" },
            { nome: "CRK Medicina Ocupacional", bairro: "Moema", cidade: "São Paulo", lat: -23.597085, lng: -46.6628884, regiao: "sul" },
            { nome: "ETIKZ Medicina e Seg. do Trabalho", bairro: "Vila Mariana", cidade: "São Paulo", lat: -23.5803633, lng: -46.6398169, regiao: "sul" },
            { nome: "Clínica Master Medicina do Trabalho", bairro: "Brooklin", cidade: "São Paulo", lat: -23.6268017, lng: -46.6881279, regiao: "sul" },
            { nome: "Clínica Medcorp", bairro: "Brooklin", cidade: "São Paulo", lat: -23.6099689, lng: -46.6771785, regiao: "sul" },
            { nome: "MSul Ocupacional", bairro: "Brooklin Paulista", cidade: "São Paulo", lat: -23.6294989, lng: -46.6736894, regiao: "sul" },
            { nome: "GSST", bairro: "Campo Belo", cidade: "São Paulo", lat: -23.6299339, lng: -46.670417, regiao: "sul" },
            { nome: "RPMED", bairro: "Campo Belo", cidade: "São Paulo", lat: -23.6299339, lng: -46.670417, regiao: "sul" },
            { nome: "Almassessoria", bairro: "Campo Belo", cidade: "São Paulo", lat: -23.6299339, lng: -46.670417, regiao: "sul" },
            { nome: "W FER MEDICINA DO TRABALHO", bairro: "Moema", cidade: "São Paulo", lat: -23.6078548, lng: -46.663132, regiao: "sul" },
            { nome: "CLV Medicina e Segurança do Trabalho", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6302105, lng: -46.6938976, regiao: "sul" },
            { nome: "Medin", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.65269, lng: -46.7060021, regiao: "sul" },
            { nome: "Limiar", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6562303, lng: -46.7191156, regiao: "sul" },
            { nome: "Conceitus MED", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6330899, lng: -46.69071, regiao: "sul" },
            { nome: "jfk soluções ocupacionais", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6380537, lng: -46.6957977, regiao: "sul" },
            { nome: "MTA - Médicos do Trabalho Associados", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6476074, lng: -46.7073491, regiao: "sul" },
            { nome: "MEDCORP MEDICINA DO TRABALHO", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6361182, lng: -46.6956898, regiao: "sul" },
            { nome: "Limiar - Medicina do Trabalho", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6562303, lng: -46.7191156, regiao: "sul" },
            { nome: "Central Documentos", bairro: "Santo Amaro", cidade: "São Paulo", lat: -23.6538686, lng: -46.7070141, regiao: "sul" },
            { nome: "Labor Med - Medicina do Trabalho", bairro: "Jardim Aeroporto", cidade: "São Paulo", lat: -23.6345362, lng: -46.6683174, regiao: "sul" },
            { nome: "GraalSeg", bairro: "Chácara Santo Antônio", cidade: "São Paulo", lat: -23.6302388, lng: -46.7039869, regiao: "sul" },
            { nome: "Sonamed Medicina do Trabalho", bairro: "Santana", cidade: "São Paulo", lat: -23.5073306, lng: -46.6256108, regiao: "norte" },
            { nome: "Grupo Previne - Unidade Santana", bairro: "Santana", cidade: "São Paulo", lat: -23.4998429, lng: -46.6218898, regiao: "norte" },
            { nome: "LAVORATORI", bairro: "Lauzane Paulista", cidade: "São Paulo", lat: -23.4713573, lng: -46.6445383, regiao: "norte" },
            { nome: "Allmed", bairro: "89", cidade: "Vila Anastácio", lat: -23.5150183, lng: -46.7186734, regiao: "oeste" },
            { nome: "Setrab", bairro: "120", cidade: "Vila Mariana", lat: -23.5897089, lng: -46.6345233, regiao: "oeste" },
            { nome: "MMC Saúde", bairro: "417 - Cj. 23", cidade: "Pinheiros", lat: -23.5560043, lng: -46.6747606, regiao: "oeste" },
            { nome: "Medicina Ocupacional na Lapa - Agimed", bairro: "220", cidade: "Lapa", lat: -23.5211614, lng: -46.7065937, regiao: "oeste" },
            { nome: "Goldmed Medicine and Safety", bairro: "237", cidade: "Lapa", lat: -23.5206816, lng: -46.7056877, regiao: "oeste" },
            { nome: "L&T Saúde Medicina do Trabalho", bairro: "150", cidade: "Lapa", lat: -23.5256124, lng: -46.7079886, regiao: "oeste" },
            { nome: "MEDNET Lapa/SP - Medicina e Segurança do Trabalho", bairro: "180", cidade: "Lapa", lat: -23.5215838, lng: -46.7021946, regiao: "oeste" },
            { nome: "Trabmed Medicina e Segurança do Trabalho", bairro: "300", cidade: "Lapa", lat: -23.5205076, lng: -46.7086218, regiao: "oeste" },
            { nome: "KellsMed", bairro: "63", cidade: "Lapa", lat: -23.5190433, lng: -46.7035699, regiao: "oeste" },
            { nome: "Topi Medicina Srguranca do Trabalho", bairro: "489", cidade: "Lapa", lat: -23.5217699, lng: -46.7074914, regiao: "oeste" },
            { nome: "Unisest - Segurança E Medicina do Trabalho Ltda.", bairro: "180", cidade: "Lapa", lat: -23.5159912, lng: -46.7218499, regiao: "oeste" },
            { nome: "PreverMed - Centro Médico e Diagnóstico", bairro: "155", cidade: "Lapa", lat: -23.5224282, lng: -46.7054913, regiao: "oeste" },
            { nome: "Grupo Atlas Medicina e Segurança do Trabalho", bairro: "41", cidade: "Lapa", lat: -23.5185244, lng: -46.705894, regiao: "oeste" },
            { nome: "Med Medicina e Segurança do Trabalho", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.5705456, lng: -46.6966535, regiao: "oeste" },
            { nome: "Spix Medicina Ocupacional", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.567249, lng: -46.7019515, regiao: "oeste" },
            { nome: "GBAM Health and Safety", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.567249, lng: -46.7019515, regiao: "oeste" },
            { nome: "Cemtra-Centro Empecizlizado em Medicina do Trabalho", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.5556066, lng: -46.6742342, regiao: "oeste" },
            { nome: "CIMEO - Centro Integrado de Medicina e Engenharia Ocupacional.", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.567249, lng: -46.7019515, regiao: "oeste" },
            { nome: "Work Care - Clínica de Medicina e Segurança do Trabalho em Pinheiros", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.5608698, lng: -46.675898, regiao: "oeste" },
            { nome: "Sarah Medicina do Trabalho", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.567249, lng: -46.7019515, regiao: "oeste" },
            { nome: "Salú", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.5684714, lng: -46.6883131, regiao: "oeste" },
            { nome: "RGP ENGENHARIA DE SEGURANÇA E MEDICINA OCUPACIONAL", bairro: "Pinheiros", cidade: "São Paulo", lat: -23.567249, lng: -46.7019515, regiao: "oeste" },
            { nome: "Triagem Medicina do Trabalho - São Paulo", bairro: "273", cidade: "Pinheiros", lat: -23.5474237, lng: -46.6913282, regiao: "oeste" },
            { nome: "AngularMed Medicina e Segurança do Trabalho", bairro: "Butantã", cidade: "São Paulo", lat: -23.5716433, lng: -46.70996, regiao: "oeste" },
            { nome: "GRF Ocupacional", bairro: "Butantã", cidade: "São Paulo", lat: -23.5715997, lng: -46.7116182, regiao: "oeste" },
            { nome: "Revi Medicina e Segurança do Trabalho", bairro: "Butantã", cidade: "São Paulo", lat: -23.5737434, lng: -46.7102643, regiao: "oeste" },
            { nome: "Prime Gestão Ocupacional - Medicina e Segurança do Trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "PRESEG - Segurança e Medicina do Trabalho - Unidade Barra Funda", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5213924, lng: -46.6603743, regiao: "oeste" },
            { nome: "Centromedic Medicina do Trabalho e Segurança do Trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5296802, lng: -46.6630921, regiao: "oeste" },
            { nome: "Grupo Bplan Saúde e Segurança do Trabalho - Barra Funda SP", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "Medicina do trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "Segmaxima Health and Safety at Work", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "D2 Ocupacional - Excelência em Medicina do Trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "Vida Ocupacional", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "Promed LGA Assessoria Medicina do Trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5284617, lng: -46.6622618, regiao: "oeste" },
            { nome: "Job Medical Advisory", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5276851, lng: -46.6628688, regiao: "oeste" },
            { nome: "JCR Engenharia de Segurança do Trabalho", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "GraalSeg (Zona Oeste) - SP | Atendimento Online e Presencial", bairro: "Barra Funda", cidade: "São Paulo", lat: -23.5254616, lng: -46.6675134, regiao: "oeste" },
            { nome: "Deltamed Guarulhos - Medicina do Trabalho - Ortopedia - Psiquiatria", bairro: "", cidade: "Guarulhos", lat: -23.4659959, lng: -46.5276422, regiao: "grande_sp" },
            { nome: "CLÍNICA DE SAÚDE OCUPACIONAL - SJR GUARULHOS", bairro: "", cidade: "Guarulhos", lat: -23.4688978, lng: -46.5251944, regiao: "grande_sp" },
            { nome: "MSJ Medicina Ocupacional", bairro: "", cidade: "Guarulhos", lat: -23.4599905, lng: -46.5360086, regiao: "grande_sp" },
            { nome: "PRESEG - Segurança e Medicina do Trabalho", bairro: "", cidade: "Guarulhos", lat: -23.4679586, lng: -46.524172, regiao: "grande_sp" },
            { nome: "Setrab Group - Unidade Guarulhos", bairro: "", cidade: "Guarulhos", lat: -23.4659959, lng: -46.5276422, regiao: "grande_sp" },
            { nome: "Medicina e Segurança do Trabalho Assessoria & Clínica Ocupacional", bairro: "", cidade: "Guarulhos", lat: -23.4464345, lng: -46.4096366, regiao: "grande_sp" },
            { nome: "Total Health - Medical and Safety", bairro: "", cidade: "Guarulhos", lat: -23.4610919, lng: -46.529104, regiao: "grande_sp" },
            { nome: "Control Med - Guarulhos", bairro: "", cidade: "Guarulhos", lat: -23.4679788, lng: -46.5319494, regiao: "grande_sp" },
            { nome: "Medsal - Medicina e Segurança Ocupacional", bairro: "", cidade: "Guarulhos", lat: -23.4638374, lng: -46.531883, regiao: "grande_sp" },
            { nome: "SEJANET", bairro: "228 – 17", cidade: "Centro", lat: -23.6562487, lng: -46.5267158, regiao: "grande_sp" },
            { nome: "Work Medicina", bairro: "199", cidade: "Jardim", lat: -23.649457, lng: -46.5350912, regiao: "grande_sp" },
            { nome: "Grupo Ana Rosa Saúde", bairro: "72", cidade: "Jardim", lat: -23.6544867, lng: -46.5357055, regiao: "grande_sp" }
        ];

        const regionColors = {
            centro: { fill: '#EF4444', border: '#991B1B' },
            leste: { fill: '#F97316', border: '#C2410C' },
            norte: { fill: '#8B5CF6', border: '#6D28D9' },
            sul: { fill: '#EC4899', border: '#BE185D' },
            oeste: { fill: '#14B8A6', border: '#0D9488' },
            grande_sp: { fill: '#F59E0B', border: '#D97706' },
        };

        const regionNames = {
            centro: 'SP - Centro',
            leste: 'SP - Zona Leste',
            norte: 'SP - Zona Norte',
            sul: 'SP - Zona Sul',
            oeste: 'SP - Zona Oeste',
            grande_sp: 'Grande SP',
        };

        let map;
        let markers = [];

        function initMap() {
            map = L.map('map').setView([-23.5505, -46.6361], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            updateRegionStats();
            updateMarkers();

            document.getElementById('showCompetitors').addEventListener('change', updateMarkers);
            document.getElementById('phaseFilter').addEventListener('change', updateMarkers);
            document.getElementById('regionFilter').addEventListener('change', updateMarkers);
        }

        function updateRegionStats() {
            const counts = {};
            concorrentes.forEach(c => {
                const r = c.regiao || 'centro';
                counts[r] = (counts[r] || 0) + 1;
            });

            const container = document.getElementById('regionStatsContent');
            container.innerHTML = '';
            const order = ['centro', 'leste', 'norte', 'sul', 'oeste', 'grande_sp'];
            order.forEach(r => {
                if (counts[r]) {
                    const div = document.createElement('div');
                    div.className = 'region-stat-row';
                    const color = regionColors[r] ? regionColors[r].fill : '#666';
                    div.innerHTML = `<span style="color:${color};">${regionNames[r] || r}</span><span class="region-stat-count">${counts[r]}</span>`;
                    container.appendChild(div);
                }
            });
            const totalDiv = document.createElement('div');
            totalDiv.className = 'region-stat-row';
            totalDiv.style.fontWeight = 'bold';
            totalDiv.style.marginTop = '4px';
            totalDiv.innerHTML = `<span>TOTAL</span><span>${concorrentes.length}</span>`;
            container.appendChild(totalDiv);
        }

        function updateMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const showComp = document.getElementById('showCompetitors').checked;
            const phase = document.getElementById('phaseFilter').value;
            const region = document.getElementById('regionFilter').value;
            const searchTerm = (document.getElementById('searchInput').value || '').toLowerCase();

            let compCount = 0;

            suas_unidades.forEach(unit => {
                if (phase && unit.fase !== phase) return;
                
                const marker = L.circleMarker([unit.lat, unit.lng], {
                    radius: 9,
                    fillColor: '#3B82F6',
                    color: '#1E40AF',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.9
                }).addTo(map);

                marker.bindPopup(`
                    <strong>${unit.nome}</strong><br/>
                    <em>Sua Unidade</em><br/>
                    Fase: ${unit.fase}<br/>
                    Custo: ${unit.custo}<br/>
                    Faturamento: ${unit.faturamento}
                `);
                markers.push(marker);
            });

            if (showComp) {
                concorrentes.forEach(comp => {
                    if (region && comp.regiao !== region) return;
                    if (searchTerm && !comp.nome.toLowerCase().includes(searchTerm)) return;

                    compCount++;

                    const r = comp.regiao || 'centro';
                    const fillColor = regionColors[r] ? regionColors[r].fill : '#EF4444';
                    const borderColor = regionColors[r] ? regionColors[r].border : '#991B1B';

                    const marker = L.circleMarker([comp.lat, comp.lng], {
                        radius: 6,
                        fillColor: fillColor,
                        color: borderColor,
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.7
                    }).addTo(map);

                    let popupContent = `<strong>${comp.nome}</strong>`;
                    if (comp.bairro) popupContent += `<br/>Bairro: ${comp.bairro}`;
                    if (comp.cidade) popupContent += `<br/>Cidade: ${comp.cidade}`;
                    popupContent += `<br/>Região: ${regionNames[r] || r}`;

                    marker.bindPopup(popupContent);
                    markers.push(marker);
                });
            }

            document.getElementById('compCount').textContent = compCount;
        }

        window.addEventListener('load', initMap);
    </script>
</body>
</html>