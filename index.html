<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Expansão - Análise de Concorrência</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 340px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow-y: auto; padding: 20px; }
        .map { flex: 1; }
        h1 { font-size: 22px; margin-bottom: 5px; color: #333; }
        .subtitle { font-size: 12px; color: #999; margin-bottom: 15px; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: #f5f5f5; padding: 12px; border-radius: 8px; text-align: center; }
        .stat-label { font-size: 11px; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 26px; font-weight: bold; }
        .blue { color: #3B82F6; }
        .red { color: #EF4444; }
        .green { color: #10B981; }
        .controls { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-size: 12px; font-weight: 500; }
        input[type="checkbox"] { width: auto; }
        select { width: 100%; padding: 7px; border: 1px solid #ddd; border-radius: 4px; font-size: 11px; margin-bottom: 5px; }
        .legend { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-top: 15px; }
        .legend-title { font-size: 11px; font-weight: 600; margin-bottom: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 11px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
        .info-box { background: #fffbeb; border-left: 4px solid #fbbf24; padding: 10px; border-radius: 4px; margin-top: 12px; font-size: 11px; }
        .info-title { font-weight: 600; color: #92400e; margin-bottom: 4px; }
        .info-text { color: #b45309; line-height: 1.4; }
        .info-box.updated { background: #ecfdf5; border-left-color: #10B981; }
        .info-box.updated .info-title { color: #065f46; }
        .info-box.updated .info-text { color: #047857; }
        .info-box.blue-box { background: #eff6ff; border-left-color: #3B82F6; }
        .info-box.blue-box .info-title { color: #1e40af; }
        .info-box.blue-box .info-text { color: #1d4ed8; }
        .region-filter { margin-top: 5px; }
        .new-badge { background: #10B981; color: white; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 5px; font-weight: 600; }
        .region-stats { margin-top: 12px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .region-stats-title { font-size: 11px; font-weight: 600; margin-bottom: 6px; }
        .region-stat-row { display: flex; justify-content: space-between; font-size: 11px; padding: 3px 0; border-bottom: 1px solid #eee; }
        .region-stat-row:last-child { border-bottom: none; }
        .region-stat-count { font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Mapa de Expansão</h1>
            <p class="subtitle">Análise de Concorrência - Grande SP</p>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Suas Unidades</div>
                    <div class="stat-value blue">19</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Concorrentes</div>
                    <div class="stat-value red" id="compCount">101+</div>
                </div>
            </div>

            <div class="controls">
                <label>
                    <input type="checkbox" id="showCompetitors" checked> Mostrar Concorrentes
                </label>

                <label>
                    <input type="checkbox" id="showNewOnly"> Apenas Novos <span class="new-badge">+35</span>
                </label>
                
                <label>Filtrar Fase</label>
                <select id="phaseFilter">
                    <option value="">Todas as Fases</option>
                    <option value="F1">F1 - Âncora</option>
                    <option value="F2">F2 - Expansão</option>
                    <option value="F3">F3 - Dominação</option>
                    <option value="F4">F4 - Metropolitana</option>
                </select>

                <div class="region-filter">
                    <label>Filtrar Região Concorrentes</label>
                    <select id="regionFilter">
                        <option value="">Todas as Regiões</option>
                        <option value="centro">Centro</option>
                        <option value="norte">Zona Norte</option>
                        <option value="sul">Zona Sul</option>
                        <option value="oeste">Zona Oeste</option>
                        <option value="leste">Zona Leste</option>
                        <option value="grande_sp_leste">Grande SP - ABC/Guarulhos</option>
                        <option value="grande_sp_oeste">Grande SP - Oeste</option>
                    </select>
                </div>
            </div>

            <div class="region-stats" id="regionStats">
                <div class="region-stats-title">CONCORRENTES POR REGIÃO</div>
                <div id="regionStatsContent"></div>
            </div>

            <div class="legend">
                <div class="legend-title">LEGENDA</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #3B82F6; border: 2px solid #1E40AF;"></div>
                    <span>Suas Unidades (Azul)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #EF4444; border: 2px solid #991B1B;"></div>
                    <span>Concorrentes Originais (Vermelho)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #F97316; border: 2px solid #C2410C;"></div>
                    <span>Novos - Zona Leste (Laranja)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #8B5CF6; border: 2px solid #6D28D9;"></div>
                    <span>Novos - Zona Norte (Roxo)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #EC4899; border: 2px solid #BE185D;"></div>
                    <span>Novos - Zona Sul (Rosa)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #14B8A6; border: 2px solid #0D9488;"></div>
                    <span>Novos - Zona Oeste (Teal)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #F59E0B; border: 2px solid #D97706;"></div>
                    <span>Novos - Grande SP (Amarelo)</span>
                </div>
            </div>

            <div class="info-box updated">
                <div class="info-title">ATUALIZAÇÃO GERAL - Fev/2026</div>
                <div class="info-text">+35 novos concorrentes mapeados em todas as regiões: Zona Norte (16), Zona Sul (6), Zona Oeste (4), ABC/Guarulhos (12) e Grande SP Oeste (5). Total atualizado: 101+ concorrentes.</div>
            </div>

            <div class="info-box blue-box" style="margin-top: 8px;">
                <div class="info-title">COBERTURA COMPLETA</div>
                <div class="info-text">Mapa agora cobre toda a Grande São Paulo com dados de 7 regiões distintas.</div>
            </div>
        </div>

        <div class="map" id="map"></div>
    </div>

    <script>
        const suas_unidades = [
            { fase: "F1", nome: "Paulista", lat: -23.5505, lng: -46.6561, custo: "R$ 80.5K", faturamento: "R$ 160K" },
            { fase: "F1", nome: "Santo Amaro", lat: -23.6245, lng: -46.6561, custo: "R$ 71.5K", faturamento: "R$ 140K" },
            { fase: "F1", nome: "Tatuapé", lat: -23.5305, lng: -46.5561, custo: "R$ 69.7K", faturamento: "R$ 135K" },
            { fase: "F1", nome: "Lapa", lat: -23.5205, lng: -46.6861, custo: "R$ 64.7K", faturamento: "R$ 120K" },
            { fase: "F2", nome: "Itaim Bibi", lat: -23.5889, lng: -46.6799, custo: "R$ 87.2K", faturamento: "R$ 200K" },
            { fase: "F2", nome: "Mooca", lat: -23.5405, lng: -46.5561, custo: "R$ 64.8K", faturamento: "R$ 125K" },
            { fase: "F2", nome: "Santana", lat: -23.4905, lng: -46.6161, custo: "R$ 65.5K", faturamento: "R$ 120K" },
            { fase: "F2", nome: "Penha", lat: -23.5205, lng: -46.4861, custo: "R$ 57.8K", faturamento: "R$ 100K" },
            { fase: "F2", nome: "Jabaquara", lat: -23.6145, lng: -46.5561, custo: "R$ 58.2K", faturamento: "R$ 95K" },
            { fase: "F3", nome: "Berrini", lat: -23.5889, lng: -46.6799, custo: "R$ 80K", faturamento: "R$ 180K" },
            { fase: "F3", nome: "Itaquera", lat: -23.5005, lng: -46.4261, custo: "R$ 52.7K", faturamento: "R$ 85K" },
            { fase: "F3", nome: "Vila Maria", lat: -23.4705, lng: -46.5561, custo: "R$ 58.3K", faturamento: "R$ 110K" },
            { fase: "F3", nome: "Pinheiros", lat: -23.5589, lng: -46.6989, custo: "R$ 71.5K", faturamento: "R$ 140K" },
            { fase: "F3", nome: "Centro", lat: -23.5505, lng: -46.6361, custo: "R$ 58.2K", faturamento: "R$ 110K" },
            { fase: "F3", nome: "Campo Limpo", lat: -23.6545, lng: -46.7561, custo: "R$ 52K", faturamento: "R$ 80K" },
            { fase: "F4", nome: "Guarulhos", lat: -23.4605, lng: -46.4861, custo: "R$ 63.9K", faturamento: "R$ 130K" },
            { fase: "F4", nome: "Osasco", lat: -23.5305, lng: -46.7961, custo: "R$ 59.1K", faturamento: "R$ 110K" },
            { fase: "F4", nome: "São Bernardo", lat: -23.6945, lng: -46.5661, custo: "R$ 65.6K", faturamento: "R$ 140K" },
            { fase: "F4", nome: "Alphaville", lat: -23.5705, lng: -46.8561, custo: "R$ 69.9K", faturamento: "R$ 150K" },
        ];

        // Concorrentes originais (Centro)
        const concorrentes_originais = [
            { nome: "Care Plus", tipo: "Premium", lat: -23.5505, lng: -46.6561, regiao: "centro" },
            { nome: "Engemed", tipo: "Especializado", lat: -23.5515, lng: -46.6371, regiao: "centro" },
            { nome: "Paromed", tipo: "Especializado", lat: -23.4805, lng: -46.6161, regiao: "centro" },
            { nome: "Setrab Group", tipo: "Especializado", lat: -23.5525, lng: -46.6551, regiao: "centro" },
            { nome: "CONAME", tipo: "Híbrido", lat: -23.5495, lng: -46.6371, regiao: "centro" },
            { nome: "SSW Medicina", tipo: "Especializado", lat: -23.6245, lng: -46.6561, regiao: "centro" },
            { nome: "Labormesp", tipo: "Especializado", lat: -23.5305, lng: -46.4561, regiao: "leste" },
            { nome: "SMT Serviço", tipo: "Tradicional", lat: -23.5515, lng: -46.6351, regiao: "centro" },
            { nome: "WJR Segurança", tipo: "Médio Porte", lat: -23.5305, lng: -46.7561, regiao: "centro" },
            { nome: "MediClass", tipo: "Médio Porte", lat: -23.6255, lng: -46.6551, regiao: "centro" },
            { nome: "Athuar Medicina", tipo: "Médio Porte", lat: -23.5315, lng: -46.4551, regiao: "leste" },
            { nome: "GraalSeg", tipo: "Médio Porte", lat: -23.4815, lng: -46.6151, regiao: "centro" },
            { nome: "MESO Saúde", tipo: "Especializado", lat: -23.5515, lng: -46.6571, regiao: "centro" },
            { nome: "Premium Saúde", tipo: "Premium", lat: -23.6235, lng: -46.6571, regiao: "centro" },
            { nome: "Line Medicina", tipo: "Médio Porte", lat: -23.5515, lng: -46.6371, regiao: "centro" },
            { nome: "RGP Engenharia", tipo: "Especializado", lat: -23.5315, lng: -46.4571, regiao: "leste" },
            { nome: "Âncora Saúde", tipo: "Premium", lat: -23.5495, lng: -46.6551, regiao: "centro" },
            { nome: "PGRSP Segurança", tipo: "Especializado", lat: -23.4815, lng: -46.6171, regiao: "centro" },
            { nome: "KS Treinamento", tipo: "Médio Porte", lat: -23.5525, lng: -46.6351, regiao: "centro" },
            { nome: "PHO Consultoria", tipo: "Consultoria", lat: -23.6255, lng: -46.6541, regiao: "centro" },
            { nome: "AlfaSeg", tipo: "Médio Porte", lat: -23.5315, lng: -46.7551, regiao: "centro" },
            { nome: "Porto Seguro", tipo: "Segurador", lat: -23.5495, lng: -46.6571, regiao: "centro" },
            { nome: "Contramed", tipo: "Especializado", lat: -23.5525, lng: -46.6361, regiao: "centro" },
            { nome: "Grupo Moratti", tipo: "Médio Porte", lat: -23.5315, lng: -46.4541, regiao: "leste" },
            { nome: "Rama Medicina", tipo: "Médio Porte", lat: -23.6235, lng: -46.6541, regiao: "centro" },
            { nome: "Omini Saúde", tipo: "Médio Porte", lat: -23.5515, lng: -46.6351, regiao: "centro" },
            { nome: "CMS Ocupacional", tipo: "Médio Porte", lat: -23.5315, lng: -46.7541, regiao: "centro" },
            { nome: "CRP Medicina", tipo: "Médio Porte", lat: -23.5325, lng: -46.4561, regiao: "leste" },
            { nome: "Ravim Saúde", tipo: "Médio Porte", lat: -23.5515, lng: -46.4351, regiao: "leste" },
            { nome: "Ideia Medicina", tipo: "Especializado", lat: -23.4805, lng: -46.6171, regiao: "centro" },
            { nome: "IG Segurança", tipo: "Especializado", lat: -23.5525, lng: -46.6371, regiao: "centro" },
            { nome: "Safety Quest", tipo: "Especializado", lat: -23.5325, lng: -46.7551, regiao: "centro" },
            { nome: "CL&M Saúde", tipo: "Médio Porte", lat: -23.6245, lng: -46.6541, regiao: "centro" },
            { nome: "Cemed Ocupacional", tipo: "Médio Porte", lat: -23.5305, lng: -46.4551, regiao: "leste" },
            { nome: "SES Saúde", tipo: "Médio Porte", lat: -23.5495, lng: -46.6361, regiao: "centro" },
            { nome: "Clínica Abreu", tipo: "Tradicional", lat: -23.6255, lng: -46.6561, regiao: "centro" },
            { nome: "Imasa Seguros", tipo: "Segurador", lat: -23.5515, lng: -46.6561, regiao: "centro" },
            { nome: "Saúde Ocupacional Plus", tipo: "Médio Porte", lat: -23.4815, lng: -46.6161, regiao: "centro" },
            { nome: "Medicina Preventiva", tipo: "Especializado", lat: -23.5495, lng: -46.6351, regiao: "centro" },
            { nome: "Segurança Total", tipo: "Médio Porte", lat: -23.5325, lng: -46.7561, regiao: "centro" },
            { nome: "Ocupacional Brasil", tipo: "Médio Porte", lat: -23.5315, lng: -46.4571, regiao: "leste" },
        ];

        // Concorrentes Zona Leste (pesquisados anteriormente)
        const concorrentes_zona_leste = [
            { nome: "SanMedi Saúde e Segurança", tipo: "Especializado", lat: -23.5419, lng: -46.5745, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "Macromed Medicina Ocupacional", tipo: "Especializado", lat: -23.5209, lng: -46.5463, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "D+ SAÚDE Medicina", tipo: "Médio Porte", lat: -23.5332, lng: -46.5786, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "Pro Ocupacional Tatuapé", tipo: "Médio Porte", lat: -23.5243, lng: -46.5810, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "QuallitSeg Assessoria", tipo: "Especializado", lat: -23.5253, lng: -46.5437, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "Grupo Previne Itaquera", tipo: "Médio Porte", lat: -23.5410, lng: -46.4555, regiao: "leste", bairro: "Itaquera", novo: true },
            { nome: "Alpamed Engenharia", tipo: "Especializado", lat: -23.5445, lng: -46.5094, regiao: "leste", bairro: "Vila Matilde", novo: true },
            { nome: "Clínica Monsenhor Ciro", tipo: "Tradicional", lat: -23.5277, lng: -46.5439, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "Grupo SOS Tatuapé", tipo: "Médio Porte", lat: -23.5385, lng: -46.5774, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "AF Segurança Itaquera", tipo: "Médio Porte", lat: -23.5441, lng: -46.4525, regiao: "leste", bairro: "Itaquera", novo: true },
            { nome: "A&L Assessoria Medicina", tipo: "Médio Porte", lat: -23.5302, lng: -46.5782, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "Bettiati Saúde Ocupacional", tipo: "Especializado", lat: -23.5232, lng: -46.5315, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "Itamedi Saúde Ocupacional", tipo: "Especializado", lat: -23.5342, lng: -46.5797, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "Pontual SST", tipo: "Especializado", lat: -23.6167, lng: -46.4714, regiao: "leste", bairro: "São Mateus", novo: true },
            { nome: "Mais Prevenção", tipo: "Especializado", lat: -23.5552, lng: -46.5135, regiao: "leste", bairro: "Aricanduva", novo: true },
            { nome: "My Doctor Medicina", tipo: "Médio Porte", lat: -23.5198, lng: -46.5399, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "ISO Saúde Ocupacional", tipo: "Especializado", lat: -23.5278, lng: -46.5361, regiao: "leste", bairro: "Penha", novo: true },
            { nome: "Neobiowork Medicina", tipo: "Médio Porte", lat: -23.5402, lng: -46.4754, regiao: "leste", bairro: "Arthur Alvim", novo: true },
            { nome: "PrevMed São Miguel", tipo: "Médio Porte", lat: -23.4913, lng: -46.4402, regiao: "leste", bairro: "São Miguel", novo: true },
            { nome: "Semework Medicina", tipo: "Médio Porte", lat: -23.4739, lng: -46.4692, regiao: "leste", bairro: "Ermelino Matarazzo", novo: true },
            { nome: "Neoformar Medicina", tipo: "Médio Porte", lat: -23.6163, lng: -46.4705, regiao: "leste", bairro: "São Mateus", novo: true },
            { nome: "MCI Vitta Medicina", tipo: "Especializado", lat: -23.5619, lng: -46.4705, regiao: "leste", bairro: "Cidade Líder", novo: true },
            { nome: "CEDUSP Tatuapé", tipo: "Premium", lat: -23.5357, lng: -46.5759, regiao: "leste", bairro: "Tatuapé", novo: true },
            { nome: "Evydence Medicina", tipo: "Especializado", lat: -23.5908, lng: -46.5136, regiao: "leste", bairro: "Sapopemba", novo: true },
            { nome: "Access Segurança", tipo: "Médio Porte", lat: -23.5378, lng: -46.4145, regiao: "leste", bairro: "Guaianases", novo: true },
        ];

        // NOVOS - Zona Norte
        const concorrentes_norte = [
            { nome: "Sona Med", tipo: "Especializado", lat: -23.5029, lng: -46.6235, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Numedlab", tipo: "Tradicional", lat: -23.5029, lng: -46.6235, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Cliniserv", tipo: "Médio Porte", lat: -23.47, lng: -46.63, regiao: "norte", bairro: "Zona Norte", novo: true },
            { nome: "Grupo Previne Santana", tipo: "Especializado", lat: -23.502, lng: -46.626, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Simplifica Ocupacional", tipo: "Médio Porte", lat: -23.501, lng: -46.628, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "ASCONCIPA", tipo: "Tradicional", lat: -23.506, lng: -46.625, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Polygonal Saúde e Segurança", tipo: "Especializado", lat: -23.504, lng: -46.626, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Grupo Mast", tipo: "Médio Porte", lat: -23.493, lng: -46.633, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Samtra", tipo: "Médio Porte", lat: -23.507, lng: -46.626, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Assemetra", tipo: "Tradicional", lat: -23.504, lng: -46.624, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "Cardoso de Almeida SST", tipo: "Especializado", lat: -23.5, lng: -46.631, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "MOC Saúde Ocupacional", tipo: "Premium", lat: -23.504, lng: -46.627, regiao: "norte", bairro: "Santana", novo: true },
            { nome: "LABORE Saúde Ocupacional", tipo: "Médio Porte", lat: -23.505, lng: -46.626, regiao: "norte", bairro: "Santana", novo: true },
        ];

        // NOVOS - Zona Sul
        const concorrentes_sul = [
            { nome: "Geremed Ocupacional", tipo: "Médio Porte", lat: -23.6215, lng: -46.6968, regiao: "sul", bairro: "Brooklin", novo: true },
            { nome: "CLIMEC", tipo: "Tradicional", lat: -23.6525, lng: -46.7, regiao: "sul", bairro: "Santo Amaro", novo: true },
            { nome: "Medtrab Jabaquara", tipo: "Tradicional", lat: -23.6442, lng: -46.6442, regiao: "sul", bairro: "Jabaquara", novo: true },
            { nome: "Limiar Medicina do Trabalho", tipo: "Tradicional", lat: -23.6525, lng: -46.7, regiao: "sul", bairro: "Santo Amaro", novo: true },
            { nome: "Sglobal Assessoria", tipo: "Premium", lat: -23.7031, lng: -46.7017, regiao: "sul", bairro: "Interlagos", novo: true },
            { nome: "Grupo Mednet", tipo: "Premium", lat: -23.6525, lng: -46.7, regiao: "sul", bairro: "Santo Amaro", novo: true },
        ];

        // NOVOS - Zona Oeste
        const concorrentes_oeste = [
            { nome: "Lapamedseg", tipo: "Especializado", lat: -23.5259, lng: -46.7012, regiao: "oeste", bairro: "Lapa", novo: true },
            { nome: "AngularMed", tipo: "Premium", lat: -23.572, lng: -46.7111, regiao: "oeste", bairro: "Butantã", novo: true },
            { nome: "Preseg Assessoria", tipo: "Tradicional", lat: -23.5262, lng: -46.6654, regiao: "oeste", bairro: "Barra Funda", novo: true },
            { nome: "BetelSeg", tipo: "Especializado", lat: -23.5259, lng: -46.7012, regiao: "oeste", bairro: "Lapa", novo: true },
        ];

        // NOVOS - Grande SP (ABC/Guarulhos)
        const concorrentes_grande_sp_leste = [
            { nome: "Primemed", tipo: "Especializado", lat: -23.6645, lng: -46.5318, regiao: "grande_sp_leste", bairro: "Santo André Centro", novo: true },
            { nome: "Gedal Med", tipo: "Especializado", lat: -23.6833, lng: -46.5667, regiao: "grande_sp_leste", bairro: "Rudge Ramos - SBC", novo: true },
            { nome: "Med Trab Assunção", tipo: "Tradicional", lat: -23.7167, lng: -46.5833, regiao: "grande_sp_leste", bairro: "Planalto - SBC", novo: true },
            { nome: "Objetiva Medicina SST", tipo: "Tradicional", lat: -23.6645, lng: -46.5318, regiao: "grande_sp_leste", bairro: "Santo André Centro", novo: true },
            { nome: "Assemet", tipo: "Especializado", lat: -23.7033, lng: -46.5619, regiao: "grande_sp_leste", bairro: "Baeta Neves - SBC", novo: true },
            { nome: "Medsal", tipo: "Especializado", lat: -23.4636, lng: -46.5334, regiao: "grande_sp_leste", bairro: "Guarulhos Centro", novo: true },
            { nome: "Presmed", tipo: "Especializado", lat: -23.4636, lng: -46.5334, regiao: "grande_sp_leste", bairro: "Guarulhos Centro", novo: true },
            { nome: "Deltamed", tipo: "Especializado", lat: -23.4636, lng: -46.5334, regiao: "grande_sp_leste", bairro: "Guarulhos Centro", novo: true },
            { nome: "IACI Med", tipo: "Especializado", lat: -23.4544, lng: -46.5242, regiao: "grande_sp_leste", bairro: "Maia - Guarulhos", novo: true },
            { nome: "Brasmed Saúde Ocupacional", tipo: "Especializado", lat: -23.4636, lng: -46.5334, regiao: "grande_sp_leste", bairro: "Guarulhos", novo: true },
            { nome: "Lavoro Medicina", tipo: "Especializado", lat: -23.6667, lng: -46.4333, regiao: "grande_sp_leste", bairro: "Mauá", novo: true },
            { nome: "Bannoki Medicina Integrada", tipo: "Especializado", lat: -23.6667, lng: -46.4333, regiao: "grande_sp_leste", bairro: "Mauá", novo: true },
        ];

        // NOVOS - Grande SP Oeste
        const concorrentes_grande_sp_oeste = [
            { nome: "Plenitude Medical", tipo: "Especializado", lat: -23.5029, lng: -46.8517, regiao: "grande_sp_oeste", bairro: "Alphaville Industrial", novo: true },
            { nome: "Camargo Dantas", tipo: "Médio Porte", lat: -23.5214, lng: -46.8369, regiao: "grande_sp_oeste", bairro: "Carapicuíba", novo: true },
            { nome: "SPIX", tipo: "Premium", lat: -23.5104, lng: -46.8765, regiao: "grande_sp_oeste", bairro: "Barueri", novo: true },
            { nome: "Alphalife", tipo: "Tradicional", lat: -23.5085, lng: -46.8495, regiao: "grande_sp_oeste", bairro: "Alphaville", novo: true },
            { nome: "Trade Ocupacional", tipo: "Médio Porte", lat: -23.5016, lng: -46.8594, regiao: "grande_sp_oeste", bairro: "Bethaville - Barueri", novo: true },
        ];

        // Combinar todos os concorrentes
        const concorrentes = [
            ...concorrentes_originais,
            ...concorrentes_zona_leste,
            ...concorrentes_norte,
            ...concorrentes_sul,
            ...concorrentes_oeste,
            ...concorrentes_grande_sp_leste,
            ...concorrentes_grande_sp_oeste,
        ];

        // Cores por região para novos
        const regionColors = {
            centro: { fill: '#EF4444', border: '#991B1B' },
            leste: { fill: '#F97316', border: '#C2410C' },
            norte: { fill: '#8B5CF6', border: '#6D28D9' },
            sul: { fill: '#EC4899', border: '#BE185D' },
            oeste: { fill: '#14B8A6', border: '#0D9488' },
            grande_sp_leste: { fill: '#F59E0B', border: '#D97706' },
            grande_sp_oeste: { fill: '#F59E0B', border: '#D97706' },
        };

        const regionNames = {
            centro: 'Centro',
            leste: 'Zona Leste',
            norte: 'Zona Norte',
            sul: 'Zona Sul',
            oeste: 'Zona Oeste',
            grande_sp_leste: 'ABC/Guarulhos',
            grande_sp_oeste: 'Grande SP Oeste',
        };

        let map;
        let markers = [];

        function initMap() {
            map = L.map('map').setView([-23.5505, -46.6361], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            updateRegionStats();
            updateMarkers();

            document.getElementById('showCompetitors').addEventListener('change', updateMarkers);
            document.getElementById('showNewOnly').addEventListener('change', updateMarkers);
            document.getElementById('phaseFilter').addEventListener('change', updateMarkers);
            document.getElementById('regionFilter').addEventListener('change', updateMarkers);
        }

        function updateRegionStats() {
            const counts = {};
            concorrentes.forEach(c => {
                const r = c.regiao || 'centro';
                counts[r] = (counts[r] || 0) + 1;
            });

            const container = document.getElementById('regionStatsContent');
            container.innerHTML = '';
            const order = ['centro', 'leste', 'norte', 'sul', 'oeste', 'grande_sp_leste', 'grande_sp_oeste'];
            order.forEach(r => {
                if (counts[r]) {
                    const div = document.createElement('div');
                    div.className = 'region-stat-row';
                    const color = regionColors[r] ? regionColors[r].fill : '#666';
                    div.innerHTML = `<span style="color:${color};">${regionNames[r] || r}</span><span class="region-stat-count">${counts[r]}</span>`;
                    container.appendChild(div);
                }
            });
            // Total
            const totalDiv = document.createElement('div');
            totalDiv.className = 'region-stat-row';
            totalDiv.style.fontWeight = 'bold';
            totalDiv.style.marginTop = '4px';
            totalDiv.innerHTML = `<span>TOTAL</span><span>${concorrentes.length}</span>`;
            container.appendChild(totalDiv);
        }

        function updateMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const showComp = document.getElementById('showCompetitors').checked;
            const showNewOnly = document.getElementById('showNewOnly').checked;
            const phase = document.getElementById('phaseFilter').value;
            const region = document.getElementById('regionFilter').value;

            let compCount = 0;

            suas_unidades.forEach(unit => {
                if (phase && unit.fase !== phase) return;
                
                const marker = L.circleMarker([unit.lat, unit.lng], {
                    radius: 8,
                    fillColor: '#3B82F6',
                    color: '#1E40AF',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                marker.bindPopup(`
                    <strong>${unit.nome}</strong><br/>
                    Fase: ${unit.fase}<br/>
                    Custo: ${unit.custo}<br/>
                    Faturamento: ${unit.faturamento}
                `);
                markers.push(marker);
            });

            if (showComp) {
                concorrentes.forEach(comp => {
                    if (region && comp.regiao !== region) return;
                    if (showNewOnly && !comp.novo) return;

                    compCount++;

                    const isNew = comp.novo;
                    const r = comp.regiao || 'centro';
                    let fillColor, borderColor;

                    if (isNew && regionColors[r]) {
                        fillColor = regionColors[r].fill;
                        borderColor = regionColors[r].border;
                    } else {
                        fillColor = '#EF4444';
                        borderColor = '#991B1B';
                    }

                    const radius = isNew ? 7 : 6;

                    const marker = L.circleMarker([comp.lat, comp.lng], {
                        radius: radius,
                        fillColor: fillColor,
                        color: borderColor,
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.7
                    }).addTo(map);

                    let popupContent = `<strong>${comp.nome}</strong><br/>Tipo: ${comp.tipo || 'Médio Porte'}`;
                    if (comp.bairro) {
                        popupContent += `<br/>Bairro: ${comp.bairro}`;
                    }
                    popupContent += `<br/>Região: ${regionNames[r] || r}`;
                    if (isNew) {
                        popupContent += `<br/><em style="color: ${fillColor};">Novo</em>`;
                    }

                    marker.bindPopup(popupContent);
                    markers.push(marker);
                });
            }

            document.getElementById('compCount').textContent = (showNewOnly ? compCount : concorrentes.length) + '+';
        }

        window.addEventListener('load', initMap);
    </script>
</body>
</html>
